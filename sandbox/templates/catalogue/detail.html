{% extends "oscar/catalogue/detail.html" %}
{% load currency_filters %}
{% load history_tags %}
{% load staticfiles %}
{% load i18n %}
{% load recommendations %}

{% block content %}
<article class="product_page"><!-- Start of product page -->

    {% if user.is_authenticated and user.is_staff %}
    <div class="row-fluid">
        <div class="well">
            <a href="{% url dashboard:catalogue-product product.id %}"><button class="btn btn-success btn-full">{% trans "Edit this product" %}</button></a>
        </div>
    </div>
    {% endif %}

    <div class="row-fluid">
        <div class="span6">
            {% include "catalogue/partials/gallery.html" %}
        </div>
        <div class="span6">
            <h1>{{ product.get_title }}</h1>

            {% include "catalogue/partials/stock_record.html" %}

            {% if reviews %}
                <ul class="review_count">
                    {% for review in reviews %}
                    <li class="{{ review.score }}">{{ review.score }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="star">
                    <a id="write_review" href="{% url catalogue:reviews-add product.slug product.id %}#addreview" class="btn btn-success btn-small">{% trans "Write a review" %}</a>
                </p>
            {% endif %}

            <hr/>

            {% include "catalogue/partials/add_to_basket_form.html" %}
        </div><!-- /span6 -->
    </div><!-- /row-fluid -->

    {% block product_description %}
    {% if product.description %}
    <div id="product_description" class="sub-header">
        <h2>{% trans "Product Description" %}</h2>
    </div>
    <p>{{ product.description|safe }}</p>
    {% endif %}
    {% endblock %}

    {% block product_info %}
    <div class="sub-header">
        <h2>{% trans "Product Information" %}</h2>
    </div>
    <table class="table table-striped table-condensed">
        {% if product.upc %}
        <tr>
            <th>{% trans "UPC" %}</th><td>{{ product.upc }}</td>
        </tr>
        {% endif %}
        <tr>
            <th>{% trans "Product class" %}</th><td>{{ product.product_class.name }}</td>
        </tr>
        {% if product.stockrecord %}
        <tr>
            <th>{% trans "Price (excl. tax)" %}</th><td>{{ product.stockrecord.price_incl_tax|currency }}</td>
        </tr>
        <tr>
            <th>{% trans "Price (incl. tax)" %}</th><td>{{ product.stockrecord.price_excl_tax|currency }}</td>
        </tr>
        <tr>
            <th>{% trans "Availability" %}</th>
            <td>{{ product.stockrecord.availability }}</td>
        </tr>
        {% endif %}
        {% for av in product.attribute_values.all %}
        <tr>
            <th>{{ av.attribute.name }}</th>
            <td>{{ av.value }}</td>
        </tr>
        {% endfor %}
        <tr>
            <th>{% trans "Num reviews" %}</th>
            <td>{{ reviews.count }}</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
        </tr>
    </table>
    {% endblock %}

    {% block product_review %}
    <section>
        <div id="reviews" class="sub-header">
            <h2>{% trans "Customer Reviews" %}</h2>
        </div>
        {% if reviews %}
        <p>{% trans "Read customer reviews on this product." %}</p>
        {% else %}
        <p>{% trans "Be the first to review this product." %}</p>
        {% endif %}
       <div class="review_read">
           <a href="{% url catalogue:reviews-add product.slug product.id %}#addreview" class="btn btn-success btn-full">{% trans "Write a review" %}</a>
       </div>

        {% if reviews %}
            <div>
                {% for review in reviews|slice:":3" %}
                    <article class="review">
                        <header>
                            <h3 class="star"><a href="{{ review.get_absolute_url }}">{{ review.title }} <span>{{ review.score }}</span></a></h3>
                            <h4>{% trans "Reviewed by" %} {{ review.get_reviewer_name }} <small>({{ review.date_created }})</small></h4>
                        </header>
                        <div class="row-fluid">
                            <div class="span8 review_content">
                                <div>
                                    <p>{{ review.body|linebreaks }}</p>
                                </div>
                            </div>
                            <div class="span4 review_votes">
                                <div>
                                    {% include 'catalogue/reviews/vote_bit.html' %}
                                    {% if review.has_votes %}
                                    <p>{{ review.num_up_votes }} customer{{ review.num_up_votes|pluralize }} found this review helpful.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </article>
                {% endfor %}
                <div class="review_all">
                    <a href="{% url catalogue:reviews-list product.slug product.id %}" class="btn">{% trans "See all reviews" %}</a>
                </div>
            </div>
        {% endif %}
    </section>
    {% endblock product_review %}

    {% users_also_viewed product request.user as recommendations %}
    {% include "partials/recommendations.html" with recommendations=recommendations name="Customers also viewed" %}

    </div>
</article><!-- End of product page -->
{% endblock content %}

